; /*****************************************************************************
;  * ugBASIC - an isomorphic BASIC language compiler for retrocomputers        *
;  *****************************************************************************
;  * Copyright 2021-2026 Marco Spedaletti (asimov@mclink.it)
;  *
;  * Licensed under the Apache License, Version 2.0 (the "License
;  * you may not use this file except in compliance with the License.
;  * You may obtain a copy of the License at
;  *
;  * http://www.apache.org/licenses/LICENSE-2.0
;  *
;  * Unless required by applicable law or agreed to in writing, software
;  * distributed under the License is distributed on an "AS IS" BASIS,
;  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
;  * See the License for the specific language governing permissions and
;  * limitations under the License.
;  *----------------------------------------------------------------------------
;  * Concesso in licenza secondo i termini della Licenza Apache, versione 2.0
;  * (la "Licenza è proibito usare questo file se non in conformità alla
;  * Licenza. Una copia della Licenza è disponibile all'indirizzo:
;  *
;  * http://www.apache.org/licenses/LICENSE-2.0
;  *
;  * Se non richiesto dalla legislazione vigente o concordato per iscritto,
;  * il software distribuito nei termini della Licenza è distribuito
;  * "COSì COM'è", SENZA GARANZIE O CONDIZIONI DI ALCUN TIPO, esplicite o
;  * implicite. Consultare la Licenza per il testo specifico che regola le
;  * autorizzazioni e le limitazioni previste dalla medesima.
;  ****************************************************************************/
;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
;*                                                                             *
;*                        AUDIO SUPPORT FOR ZX SPECTRUM                        *
;*                                                                             *
;*                             by Marco Spedaletti                             *
;*                                                                             *
;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

ZXAUDIO1FREQTABLE:
    DEFW 0x6868, 0x628d, 0x5d03, 0x57bf, 0x52d7, 0x4e2b, 0x49cc, 0x45a3, 0x41b6, 0x3e06, 0x3a87, 0x373e
    DEFW 0x3425, 0x3134, 0x2e6f, 0x2bd3, 0x295c, 0x2708, 0x24d5, 0x22c2, 0x20cd, 0x1ef4, 0x1d36, 0x1b90
    DEFW 0x1a02, 0x188b, 0x1728, 0x15da, 0x149e, 0x1374, 0x125b, 0x1152, 0x1058, 0x0f6b, 0x0e9d, 0x0db8
    DEFW 0x0cf2, 0x0c36, 0x0b86, 0x0add, 0x0a40, 0x09ab, 0x091e, 0x089a, 0x081c, 0x07a6, 0x0736, 0x06cd
    DEFW 0x066a, 0x060c, 0x05b3, 0x0560, 0x0511, 0x04c6, 0x0480, 0x043d, 0x03ff, 0x03c4, 0x038c, 0x0357
    DEFW 0x0325, 0x02f7, 0x02ca, 0x02a0, 0x0279, 0x0254, 0x0231, 0x020f, 0x01f0, 0x01d3, 0x01b7, 0x019c
    DEFW 0x0183, 0x016c, 0x0156, 0x0141, 0x012d, 0x011b, 0x0109, 0x00f8, 0x00e9, 0x00da, 0x00cc, 0x00bf
    DEFW 0x00b2, 0x00a7, 0x009c, 0x0091, 0x0087, 0x007e, 0x0075, 0x006d, 0x0065, 0x005e, 0x0057, 0x0050
    DEFW 0x004a, 0x0044, 0x003e, 0x0039, 0x0034, 0x0030, 0x002b, 0x0027, 0x0023, 0x0020, 0x001c, 0x0019

ZXAUDIO1DURATIONTABLE:
    DEFW 0x0010 / 0x20, 0x0011 / 0x20, 0x0012 / 0x20, 0x0013 / 0x20, 0x0014 / 0x20, 0x0015 / 0x20, 0x0017 / 0x20, 0x0018 / 0x20, 0x0019 / 0x20, 0x001b / 0x20, 0x001d / 0x20, 0x001e / 0x20
    DEFW 0x0020 / 0x20, 0x0022 / 0x20, 0x0024 / 0x20, 0x0026 / 0x20, 0x0029 / 0x20, 0x002b / 0x20, 0x002e / 0x20, 0x0031 / 0x20, 0x0033 / 0x20, 0x0037 / 0x20, 0x003a / 0x20, 0x003d / 0x20
    DEFW 0x0041 / 0x20, 0x0045 / 0x20, 0x0049 / 0x20, 0x004d / 0x20, 0x0052 / 0x20, 0x0057 / 0x20, 0x005c / 0x20, 0x0062 / 0x20, 0x0067 / 0x20, 0x006e / 0x20, 0x0074 / 0x20, 0x007b / 0x20
    DEFW 0x0082 / 0x20, 0x008a / 0x20, 0x0092 / 0x20, 0x009b / 0x20, 0x00a4 / 0x20, 0x00ae / 0x20, 0x00b9 / 0x20, 0x00c4 / 0x20, 0x00cf / 0x20, 0x00dc / 0x20, 0x00e9 / 0x20, 0x00f6 / 0x20
    DEFW 0x0105 / 0x20, 0x0115 / 0x20, 0x0125 / 0x20, 0x0137 / 0x20, 0x0149 / 0x20, 0x015d / 0x20, 0x0172 / 0x20, 0x0188 / 0x20, 0x019f / 0x20, 0x01b8 / 0x20, 0x01d2 / 0x20, 0x01ed / 0x20
    DEFW 0x020b / 0x20, 0x022a / 0x20, 0x024b / 0x20, 0x026e / 0x20, 0x0293 / 0x20, 0x02ba / 0x20, 0x02e4 / 0x20, 0x0310 / 0x20, 0x033e / 0x20, 0x0370 / 0x20, 0x03a4 / 0x20, 0x03db / 0x20
    DEFW 0x0417 / 0x20, 0x0455 / 0x20, 0x0497 / 0x20, 0x04dd / 0x20, 0x0527 / 0x20, 0x0575 / 0x20, 0x05c8 / 0x20, 0x0620 / 0x20, 0x067d / 0x20, 0x06e0 / 0x20, 0x0749 / 0x20, 0x07b8 / 0x20
    DEFW 0x082d / 0x20, 0x08a9 / 0x20, 0x092d / 0x20, 0x09b9 / 0x20, 0x0a4d / 0x20, 0x0aea / 0x20, 0x0b90 / 0x20, 0x0c40 / 0x20, 0x0cfa / 0x20, 0x0dc0 / 0x20, 0x0e91 / 0x20, 0x0f6f / 0x20
    DEFW 0x105a / 0x20, 0x1153 / 0x20, 0x125b / 0x20, 0x1372 / 0x20, 0x149a / 0x20, 0x15d4 / 0x20, 0x1720 / 0x20, 0x1880 / 0x20, 0x19f5 / 0x20, 0x1b80 / 0x20, 0x1d23 / 0x20, 0x1ede / 0x20

; A = note
; DE = duration (in ms)
ZXAUDIO1NOTE:
    PUSH DE

    LD E, A
    LD D, 0
    SLA E
    RL D

    PUSH DE
    LD HL, ZXAUDIO1FREQTABLE
    ADD HL, DE
    LD A, (HL)
    LD IXL, A
    INC HL
    LD A, (HL)
    LD IXH, A
    POP DE

    LD HL, ZXAUDIO1DURATIONTABLE
    ADD HL, DE
    LD A, (HL)
    LD IYL, A
    INC HL
    LD A, (HL)
    LD IYH, A

    POP DE

    SRA D
    RR E
    SRA D
    RR E
    SRA D
    RR E
    SRA D
    RR E
    SRA D
    RR E

    LD C, E
    LD HL, IY
    LD DE, HL
    LD A, C
    CP 0
    JR Z, ZXAUDIO1BELLL2
ZXAUDIO1BELLL1:
    ADD HL, DE
    DEC C
    JR NZ, ZXAUDIO1BELLL1
ZXAUDIO1BELLL2:
    LD DE, HL
    LD HL, IX
    CALL $03b5
    RET

