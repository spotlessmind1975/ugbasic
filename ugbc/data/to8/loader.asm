	ORG $D800

CODESTART
    TFR S, X
    STX TEMP
    LDU #$9FFF
    LDX #$62FF

COPYSTACKL1
    LDA , U
    STA , X
    LEAU -1, U
    LEAX -1, X
    CMPU TEMP
    BNE COPYSTACKL1
    TFR X, S

	PSHS D,Y,X,U
	; motor on
	LDA #1
	STA $6029
	JSR $E815
	LBCS BANKLOADL2
	LDX #$6400
	; move forward to the first data block
	LDU #50
BANKLOADL1SKIP
	LDA #2
	STA $6029
	JSR $E815
	LBCS BANKLOADL2
	LEAU -1,U 
	CMPU #0
	LBNE BANKLOADL1SKIP
BANKLOADL1SIZE
	; read size
	LDA #2
	STA $6029
	JSR $E815
	LBCS BANKLOADL2
	; read bytes
	CLRA
	SUBD #5
	TFR D,U 
	; skip
	LDA #2
	STA $6029
	JSR $E815
	LBCS BANKLOADL2
	JSR $E815
	LBCS BANKLOADL2
	JSR $E815
	LBCS BANKLOADL2
	JSR $E815
	LBCS BANKLOADL2
	JSR $E815
	LBCS BANKLOADL2
BANKLOADL1REPEAT
	LDA #2
	STA $6029
	JSR $E815
	LBCS BANKLOADL2
	STB ,X+
	LEAU -1,U 
	CMPU #0
	BNE BANKLOADL1REPEAT
	; skip checksum
	LDA #2
	STA $6029
	JSR $E815
BANKLOADL1END
	; move forward to the next data type
	LDU #14
	; read last block?
	LDA #2
	STA $6029
	JSR $E815
	BCS BANKLOADL2
	CMPB #$DC
	BEQ BANKLOADL2SKIP
	LEAU -2,U 
BANKLOADL2SKIP
	LDA #2
	STA $6029
	JSR $E815
	BCS BANKLOADL2
	LEAU -1,U 
	CMPU #0
	BNE BANKLOADL2SKIP
	; end of data?
	CMPB #$FF
	BEQ BANKLOADLEOD
	; read size 
	LDA #2
	STA $6029
	JSR $E815
	CLRA
	TFR D,U 
	; read next block
	JMP BANKLOADL1REPEAT
BANKLOADLEOD
	LDA #2
	STA $6029
	JSR $E815
	LDA #2
	STA $6029
	JSR $E815
	PULS D,Y,X,U

BANKLOADL2
	LDA #16
	STA $6029
	JSR $E815

    JMP $6400

TEMP    fdb $0000

